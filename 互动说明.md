# 互动功能前端开发文档

## 1. 概述

本文档描述了动物API系统中互动功能的前端开发指南，包括帖子管理、评论系统、点赞功能等相关API的调用方法和参数说明。

## 2. 认证机制

所有互动功能API都需要进行用户认证，使用JWT令牌进行授权。

### 获取令牌
- **登录API**：`POST /api/login`
- **参数**：`account`（账号）、`password`（密码）
- **响应**：包含`token`字段的JSON对象

### 使用令牌
在所有需要认证的API请求头中添加：
```
Authorization: Bearer YOUR_TOKEN
```

## 3. 帖子管理

### 3.1 创建帖子

#### API信息
- **端点**：`POST /api/posts`
- **方法**：POST
- **认证**：需要

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | Number | 是 | 用户ID |
| cat_id | Number | 是 | 猫咪ID |
| title | String | 是 | 帖子标题 |
| content | String | 是 | 帖子内容 |
| video | String | 否 | 视频文件名 |
| images | Array<String> | 否 | 图片文件名数组 |

#### 示例代码
```javascript
// 创建帖子
async function createPost() {
  const response = await fetch('http://localhost:3000/api/posts', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token'),
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      user_id: 2,
      cat_id: 3,
      title: '分享我的猫咪日常',
      content: '今天猫咪玩得很开心，分享几张照片和一段视频',
      video: 'cat_play.mp4',
      images: ['cat1.jpg', 'cat2.jpg', 'cat3.jpg']
    })
  });
  const data = await response.json();
  console.log('创建帖子结果:', data);
  return data;
}
```

### 3.2 获取帖子列表

#### API信息
- **端点**：`GET /api/posts`
- **方法**：GET
- **认证**：需要

#### 示例代码
```javascript
// 获取帖子列表
async function getPosts() {
  const response = await fetch('http://localhost:3000/api/posts', {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('帖子列表:', data);
  return data;
}
```

### 3.3 获取帖子详情

#### API信息
- **端点**：`GET /api/posts/:id`
- **方法**：GET
- **认证**：需要

#### 示例代码
```javascript
// 获取帖子详情
async function getPostById(id) {
  const response = await fetch(`http://localhost:3000/api/posts/${id}`, {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('帖子详情:', data);
  return data;
}
```

### 3.4 更新帖子

#### API信息
- **端点**：`PUT /api/posts/:id`
- **方法**：PUT
- **认证**：需要

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | String | 否 | 帖子标题 |
| content | String | 否 | 帖子内容 |
| video | String | 否 | 视频文件名 |
| images | Array<String> | 否 | 图片文件名数组 |

#### 示例代码
```javascript
// 更新帖子
async function updatePost(id, postData) {
  const response = await fetch(`http://localhost:3000/api/posts/${id}`, {
    method: 'PUT',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token'),
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(postData)
  });
  const data = await response.json();
  console.log('更新帖子结果:', data);
  return data;
}
```

### 3.5 删除帖子

#### API信息
- **端点**：`DELETE /api/posts/:id`
- **方法**：DELETE
- **认证**：需要

#### 示例代码
```javascript
// 删除帖子
async function deletePost(id) {
  const response = await fetch(`http://localhost:3000/api/posts/${id}`, {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('删除帖子结果:', data);
  return data;
}
```

## 4. 评论系统

### 4.1 创建评论

#### API信息
- **端点**：`POST /api/comments`
- **方法**：POST
- **认证**：需要

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | Number | 是 | 用户ID |
| post_id | Number | 否 | 帖子ID（与cat_id二选一） |
| cat_id | Number | 否 | 猫咪ID（与post_id二选一） |
| content | String | 是 | 评论内容 |
| parent_id | Number | 否 | 父评论ID（用于回复） |

#### 示例代码
```javascript
// 创建评论
async function createComment(commentData) {
  const response = await fetch('http://localhost:3000/api/comments', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token'),
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(commentData)
  });
  const data = await response.json();
  console.log('创建评论结果:', data);
  return data;
}

// 示例1：评论帖子
createComment({
  user_id: 2,
  post_id: 1,
  content: '猫咪好可爱啊！'
});

// 示例2：回复评论
createComment({
  user_id: 2,
  post_id: 1,
  content: '谢谢喜欢！',
  parent_id: 5 // 回复ID为5的评论
});
```

### 4.2 获取帖子评论

#### API信息
- **端点**：`GET /api/posts/:id/comments`
- **方法**：GET
- **认证**：需要

#### 示例代码
```javascript
// 获取帖子评论
async function getPostComments(postId) {
  const response = await fetch(`http://localhost:3000/api/posts/${postId}/comments`, {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('帖子评论:', data);
  return data;
}
```

### 4.3 获取猫咪评论

#### API信息
- **端点**：`GET /api/cats/:id/comments`
- **方法**：GET
- **认证**：需要

#### 示例代码
```javascript
// 获取猫咪评论
async function getCatComments(catId) {
  const response = await fetch(`http://localhost:3000/api/cats/${catId}/comments`, {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('猫咪评论:', data);
  return data;
}
```

### 4.4 点赞评论

#### API信息
- **端点**：`POST /api/comments/:id/like`
- **方法**：POST
- **认证**：需要

#### 示例代码
```javascript
// 点赞评论
async function likeComment(commentId) {
  const response = await fetch(`http://localhost:3000/api/comments/${commentId}/like`, {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('点赞评论结果:', data);
  return data;
}
```

### 4.5 取消点赞评论

#### API信息
- **端点**：`DELETE /api/comments/:id/like`
- **方法**：DELETE
- **认证**：需要

#### 示例代码
```javascript
// 取消点赞评论
async function unlikeComment(commentId) {
  const response = await fetch(`http://localhost:3000/api/comments/${commentId}/like`, {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('取消点赞评论结果:', data);
  return data;
}
```

## 5. 点赞功能

### 5.1 点赞帖子

#### API信息
- **端点**：`POST /api/likes`
- **方法**：POST
- **认证**：需要

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | Number | 是 | 用户ID |
| post_id | Number | 是 | 帖子ID |

#### 示例代码
```javascript
// 点赞帖子
async function likePost(postId) {
  const response = await fetch('http://localhost:3000/api/likes', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token'),
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      user_id: 2,
      post_id: postId
    })
  });
  const data = await response.json();
  console.log('点赞帖子结果:', data);
  return data;
}
```

### 5.2 取消点赞帖子

#### API信息
- **端点**：`DELETE /api/likes`
- **方法**：DELETE
- **认证**：需要

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | Number | 是 | 用户ID |
| post_id | Number | 是 | 帖子ID |

#### 示例代码
```javascript
// 取消点赞帖子
async function unlikePost(postId) {
  const response = await fetch('http://localhost:3000/api/likes', {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token'),
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      user_id: 2,
      post_id: postId
    })
  });
  const data = await response.json();
  console.log('取消点赞帖子结果:', data);
  return data;
}
```

### 5.3 点赞猫咪

#### API信息
- **端点**：`POST /api/cats/:id/like`
- **方法**：POST
- **认证**：需要

#### 示例代码
```javascript
// 点赞猫咪
async function likeCat(catId) {
  const response = await fetch(`http://localhost:3000/api/cats/${catId}/like`, {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('点赞猫咪结果:', data);
  return data;
}
```

### 5.4 取消点赞猫咪

#### API信息
- **端点**：`DELETE /api/cats/:id/like`
- **方法**：DELETE
- **认证**：需要

#### 示例代码
```javascript
// 取消点赞猫咪
async function unlikeCat(catId) {
  const response = await fetch(`http://localhost:3000/api/cats/${catId}/like`, {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  console.log('取消点赞猫咪结果:', data);
  return data;
}
```

## 6. 响应数据结构

### 6.1 帖子响应

#### 单个帖子
```json
{
  "id": 1,
  "user_id": 2,
  "cat_id": 3,
  "title": "测试帖子",
  "content": "这是一个测试帖子",
  "image": null,
  "video": "video1.mp4",
  "images": ["image1.jpg", "image2.jpg"],
  "likes_count": 5,
  "comments_count": 2,
  "created_at": "2026-02-26T01:43:26.000Z",
  "updated_at": "2026-02-26T02:02:42.000Z",
  "user_name": "测试用户",
  "user_avatar": null,
  "cat_name": "小黑",
  "cat_breed": "孟买猫",
  "isLiked": false,
  "comments": [] // 仅在获取帖子详情时包含
}
```

### 6.2 评论响应

#### 单个评论
```json
{
  "id": 1,
  "user_id": 2,
  "post_id": 1,
  "cat_id": null,
  "parent_id": null,
  "content": "猫咪好可爱啊！",
  "likes_count": 2,
  "created_at": "2026-02-26T02:31:00.000Z",
  "updated_at": "2026-02-26T02:31:00.000Z",
  "user_name": "测试用户",
  "user_avatar": null,
  "isLiked": false
}
```

## 7. 错误处理

### 常见错误码
| 状态码 | 说明 | 处理方式 |
|--------|------|----------|
| 401 | 未授权 | 跳转到登录页面 |
| 404 | 资源不存在 | 显示错误提示 |
| 400 | 请求参数错误 | 显示错误信息 |
| 500 | 服务器错误 | 显示错误提示 |

### 错误处理示例
```javascript
async function fetchWithErrorHandling(url, options) {
  try {
    const response = await fetch(url, options);
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('API错误:', error);
    // 显示错误提示
    showErrorMessage(error.message);
    throw error;
  }
}
```

## 8. 前端实现建议

### 8.1 状态管理
- 使用Vuex或Redux等状态管理库管理用户认证状态和互动数据
- 维护帖子列表、评论列表的本地状态，减少重复请求

### 8.2 性能优化
- 实现分页加载，避免一次性加载过多数据
- 使用图片懒加载，提高页面加载速度
- 缓存热点数据，减少API请求

### 8.3 用户体验
- 实现点赞、评论等操作的即时反馈
- 添加加载状态和错误提示
- 优化表单验证和提交体验

### 8.4 安全考虑
- 不要在前端存储敏感信息
- 验证所有用户输入
- 定期更新JWT令牌

## 9. 示例页面结构

### 9.1 帖子列表页
- 展示帖子卡片，包含标题、内容摘要、图片/视频预览、点赞数、评论数
- 实现下拉刷新和上拉加载更多
- 提供发布新帖子的入口

### 9.2 帖子详情页
- 展示完整帖子内容，包括视频和图片
- 显示评论列表，支持嵌套回复
- 提供评论输入框和点赞按钮

### 9.3 猫咪详情页
- 展示猫咪信息
- 显示相关帖子和评论
- 提供点赞和评论功能

## 10. 总结

本文档提供了互动功能的完整前端开发指南，包括API调用方法、参数说明、响应结构等。前端开发人员可以根据本文档实现完整的互动功能，为用户提供良好的社交体验。

如需进一步了解其他功能的API，请参考相关文档。